@section Scripts {
<script>
    const pokemons = [
        {
            "name": "Bulbasaur",
            "types": ["Grass", "Poison"],
            "healthPoint": 45,
            "maxHealthPoint": 45,
            "accuracy": 80,
            "defense": 49,
            "strength": 49,
            "speed": 45,
            "unlockedXp": 0,
            "skills": ["Tackle", "Vine Whip"],
            "evolveTo": null
        },
        {
            "name": "Ivysaur",
            "types": ["Grass", "Poison"],
            "healthPoint": 60,
            "maxHealthPoint": 60,
            "accuracy": 85,
            "defense": 63,
            "strength": 62,
            "speed": 60,
            "unlockedXp": 100,
            "skills": ["Razor Leaf", "Tackle"],
            "evolveTo": null
        },
        {
            "name": "Charmander",
            "types": ["Fire"],
            "healthPoint": 39,
            "maxHealthPoint": 39,
            "accuracy": 85,
            "defense": 43,
            "strength": 52,
            "speed": 65,
            "unlockedXp": 0,
            "skills": ["Scratch", "Ember"],
            "evolveTo": null
        },
        {
            "name": "Charmeleon",
            "types": ["Fire"],
            "healthPoint": 58,
            "maxHealthPoint": 58,
            "accuracy": 90,
            "defense": 58,
            "strength": 64,
            "speed": 80,
            "unlockedXp": 100,
            "skills": ["Flamethrower", "Scratch"],
            "evolveTo": null
        },
        {
            "name": "Squirtle",
            "types": ["Water"],
            "healthPoint": 44,
            "maxHealthPoint": 44,
            "accuracy": 85,
            "defense": 65,
            "strength": 48,
            "speed": 43,
            "unlockedXp": 0,
            "skills": ["Tackle", "Water Gun"],
            "evolveTo": null
        },
        {
            "name": "Wartortle",
            "types": ["Water"],
            "healthPoint": 59,
            "maxHealthPoint": 59,
            "accuracy": 90,
            "defense": 80,
            "strength": 63,
            "speed": 58,
            "unlockedXp": 100,
            "skills": ["Bubble", "Water Pulse"],
            "evolveTo": null
        },
        {
            "name": "Caterpie",
            "types": ["Bug"],
            "healthPoint": 45,
            "maxHealthPoint": 45,
            "accuracy": 70,
            "defense": 35,
            "strength": 30,
            "speed": 45,
            "unlockedXp": 0,
            "skills": ["Tackle", "String Shot"],
            "evolveTo": null
        },
        {
            "name": "Metapod",
            "types": ["Bug"],
            "healthPoint": 50,
            "maxHealthPoint": 50,
            "accuracy": 60,
            "defense": 55,
            "strength": 20,
            "speed": 30,
            "unlockedXp": 50,
            "skills": ["Harden"],
            "evolveTo": null
        },
        {
            "name": "Weedle",
            "types": ["Bug", "Poison"],
            "healthPoint": 40,
            "maxHealthPoint": 40,
            "accuracy": 70,
            "defense": 30,
            "strength": 35,
            "speed": 50,
            "unlockedXp": 0,
            "skills": ["Poison Sting", "String Shot"],
            "evolveTo": null
        },
        {
            "name": "Kakuna",
            "types": ["Bug", "Poison"],
            "healthPoint": 45,
            "maxHealthPoint": 45,
            "accuracy": 60,
            "defense": 50,
            "strength": 25,
            "speed": 35,
            "unlockedXp": 50,
            "skills": ["Harden"],
            "evolveTo": null
        }
    ];

    const listDiv = document.getElementById("pokemonList");

    // fonction async pour charger l'image
    async function renderPokemon(p, index) {
        let imgUrl = "";
        try {
            const res = await fetch(`https://pokeapi.co/api/v2/pokemon/${p.name.toLowerCase()}`);
            const data = await res.json();
            imgUrl = data.sprites.front_default;
        } catch (err) {
            console.error(`Erreur chargement image pour ${p.name}`, err);
            imgUrl = "https://via.placeholder.com/96x96?text=No+Img";
        }

        const card = document.createElement("div");
        card.className = "pokemon-card";
        card.innerHTML = `
                <input type="checkbox" id="poke${index}" name="pokemonSelect" value="${p.name}">
                <label for="poke${index}">
                    <strong>${p.name}</strong> (${p.types.join("/")})<br>
                    <img src="${imgUrl}" alt="${p.name}" /><br>
                    PV: ${p.healthPoint}<br>
                    Attaque: ${p.strength}<br>
                    Défense: ${p.defense}
                </label>
            `;
        listDiv.appendChild(card);
    }

    // boucle asynchrone
    pokemons.forEach((p, index) => {
        renderPokemon(p, index);
    });

    // validation (max 3)
    const form = document.getElementById("teamForm");
    form.addEventListener("submit", function (e) {
        const selected = document.querySelectorAll('input[name="pokemonSelect"]:checked');
        if (selected.length !== 3) {
            e.preventDefault();
            alert("Vous devez choisir exactement 3 Pokémon !");
            return false;
        }
        const team = Array.from(selected).map(el => el.value);
        localStorage.setItem("playerTeam", JSON.stringify(team));
        //window.location.href = "/Combat/Index"; // à adapter
    });
</script>
}
